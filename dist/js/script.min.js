angular.module('sloanApp', [
    'ui.router',
    'ngAnimate', 
    'appRoutes', 
    'app.factories', 
    'MainCtrl', 
    'HomeCtrl', 
    'PortfolioCtrl', 
    'PortfolioDetailCtrl', 
    'ExperienceCtrl',
    'ContactCtrl'
  ]);
angular.module('appRoutes', []).config(['$stateProvider', '$locationProvider', '$urlRouterProvider', function($stateProvider, $locationProvider, $urlRouterProvider) {

    $urlRouterProvider.otherwise("/");

    $stateProvider

        .state('home', {
            url: '/',
            views: {
                content: {
                    templateUrl: '/templates/home/home.view.html',
                    controller: 'HomeController'
                }
            }
        })

        .state('portfolio', {
            url: '/portfolio',
            views: {
                content: {
                    templateUrl: '/templates/portfolio/portfolio.view.html',
                    controller: 'PortfolioController'
                },
                footer: {
                    templateUrl: '/templates/_common/templates/footer.tmpl.html',
                }
            }
        })

            .state('portfolio.detail', {
                url: '/:portfolioId',
                views: {
                    content: {
                        templateUrl: '/templates/portfolio/detail/detail.view.html',
                        controller: 'PortfolioDetailController',
                        resolve: {
                            portfolioId: ['$stateParams', function($stateParams){
                                console.log($stateParams.portfolioId);
                                return $stateParams.portfolioId;
                            // }],
                            // portfolioDetail: ['$stateParams', function($stateParams){
                            //   $http.get('/api/portfolio/' + $stateParams.portfolioId)
                            //     .success(function (res) {
                            //       return res;
                            //     });
                            // }],
                            // portfolioPreview: ['$stateParams', function($stateParams){
                            //   $http.get('/api/portfolio/preview/' + $stateParams.portfolioId)
                            //     .success(function (res) {
                            //       return res;
                            //     });
                            }]
                        }
                    },
                    footer: {
                        templateUrl: '/templates/_common/templates/footer.tmpl.html',
                    }
                }
            })


        .state('experience', {
            url: '/experience',
            views: {
                content: {
                    templateUrl: '/templates/experience/experience.view.html',
                    controller: 'ExperienceController'
                },
                footer: {
                    templateUrl: '/templates/_common/templates/footer.tmpl.html',
                }
            }
        })

        .state('contact', {
            url: '/contact',
            views: {
                content: {
                    templateUrl: '/templates/contact/contact.view.html',
                    controller: 'ContactController'
                },
                footer: {
                    templateUrl: '/templates/_common/templates/footer.tmpl.html',
                }
            }
        });

    $locationProvider.html5Mode({
        enabled: true,
        requireBase: false
    });

}]);
angular.module('ContactCtrl', []).controller('ContactController', function($scope, Page) {

  $scope.title = 'Contact Me';
  Page.setTitle('Contact Me');

});
angular.module('ExperienceCtrl', []).controller('ExperienceController', function($scope, $http, Page) {

  $scope.title = 'Experience';
  Page.setTitle('Experience');

  $http.get('api/experience')
    .success(function (res) {
      $scope.experience = res;
    });

});
angular.module('HomeCtrl', []).controller('HomeController', function($scope, Page) {

  $scope.title = 'Home';
  Page.setTitle('Home');
});
angular.module('PortfolioCtrl', []).controller('PortfolioController', function($scope, $http, Page, $location) {

  Page.setTitle('Portfolio');
  $scope.title = 'Portfolio';

  $http.get('api/portfolio')
    .success(function (res) {
      $scope.portfolioList = res;
    });

  $scope.openItem = function(item) {
    $location.path('portfolio/' + item.id);
  };
});

angular.module('MainCtrl', []).controller('MainController', function($scope, $http, Page) {
  var vm = this;

  $scope.Page = Page;

  $http.get('/api/navigation')
    .success(function (res) {
      vm.navigation = res;
    });

  vm.view = 'thumb';
  vm.toggleView = function(item) {
    if(item !== $scope.view) {
      vm.view = vm.view === 'thumb' ? 'list': 'thumb';
    }
  };

});
(function() {
  'use strict';

  angular
    .module('app.factories', ['ngResource'])
    ;
})();

(function() {
  'use strict';

  angular
    .module('app.factories')
    .factory('NavigationResource', navigationResource)
  ;

  /* @ngInject */
  function navigationResource($resource) {
    var uri = '/api/navigation/';
    var timeout = 1000;
    console.log('return navigation api');
    //return $resource(uri, {ps: 'display'});
  }
})();

(function() {
  'use strict';

  angular
    .module('app.factories')
    .factory('Page', page)
  ;

  /* @ngInject */
  function page() {
    var title = 'Matt Sloan | UI Designer &amp; Full-Stack Developer';
    return {
      title: function() { return title + ' | Matt Sloan | UI Designer &amp; Full-Stack Developer'; },
      setTitle: function(newTitle) { title = newTitle + ' | Matt Sloan | UI Designer &amp; Full-Stack Developer' }
    };
  }
})();
angular.module('PortfolioDetailCtrl', []).controller('PortfolioDetailController', function($scope, $http, Page, portfolioId) {

  console.log('parameter: ' + portfolioId);
  
  $scope.title = 'Item';
  $http.get('/api/portfolio/' + portfolioId)
    .success(function (res) {
      $scope.portfolioDetail = res;
    });
  $http.get('/api/portfolio/preview/' + portfolioId)
    .success(function (res) {
      $scope.portfolioPreview = res;
      $scope.portfolioTools = res.tools;
      Page.setTitle(res.project);
    });
});
